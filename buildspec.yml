version: 0.2

env:
  variables:
    WORKING_DIR: $(pwd)
    PATH: "$PATH:$WORKING_DIR/bin"

phases:
  install:
    commands:
      - echo "Downloading repo command"
      - mkdir -p $WORKING_DIR/bin
      - curl http://commondatastorage.googleapis.com/git-repo-downloads/repo > $WORKING_DIR/bin/repo && chmod a+x $WORKING_DIR/bin/repo
  pre_build:
    commands:
      - git config --global user.name 'Joseph Morant Navarro'
      - git config --global user.email 'joseph.morantnavarro@gmail.com'
      - git config --global color.ui true
      - mkdir -p $WORKING_DIR/xenon
      - echo "Adding hydrogen device"
      - cp -r --parents .repo $WORKING_DIR/xenon
      - cd $WORKING_DIR/xenon
      - echo "Initializing repo"
      - repo init -u https://github.com/joseph184/platform_manifest.git -b n --depth=1
      - echo "Syncing repo"
      - repo sync -c -n -j 4 --quiet && repo sync -c -l -j 8 --quiet

  build:
    commands:
      - cd $WORKING_DIR/xenon
      - . build/envsetup.sh
      - echo "Building..."
      - breakfast hydrogen
      - brunch hydrogen